
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>search-documents - Elastica</title>
  <meta name="author" content="@ruflin">

  
  <meta name="description" content="Search-documents Search query
Retrieve results
Add filter
Facets Search documents With some documents in the index we can start searching. A basic &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://Elastica.io/getting-started/search-documents.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Elastica" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-10160648-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Elastica</a></h1>
  
    <h2>A PHP client for elasticsearch.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:Elastica.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/examples/">Examples</a></li>
  <li><a href="/api/">Api</a></li>
  <li><a href="/projects/">Projects</a></li>
  <li><a href="/faq/">FAQ</a></li>
</ul>

</nav>
  <a href="https://github.com/ruflin/Elastica"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Search-documents</h1>
    
  </header>
  
  <ul>
<li><a href="#section-query">Search query</a></li>
<li><a href="#section-retrieve">Retrieve results</a></li>
<li><a href="#section-filter">Add filter</a></li>
<li><a href="#section-facets">Facets</a></li>
</ul>


<h2 id="section-search">Search documents</h2>


<p>With some documents in the index we can start searching. A basic search is executing a query against elasticsearch. The result of a query then can be filtered by defining some filters. Additionally you can retrieve facets to create a search navigation based on filters. For further information check out the <a href="http://www.elasticsearch.org/guide/reference/query-dsl/">Query DSL</a> and the <a href="http://www.elasticsearch.org/guide/reference/api/search/facets/">Facets</a> reference. In this example we don&rsquo;t use all possible options to keep it simple. Take a look in the <a href="api/index.html">Elastica API</a> for more options.</p>

<h3 id="section-query">Search query</h3>


<p>A query retrieves a set of results matching a query. So if you search with a <code>match_all</code> query you would get all the documents in that index or type, depending on where you search. The way elasticsearch finds the documents depends also on which analyzers you defined when creating the index.</p>

<p>So how do you define a query in Elastica? Just create a Query object and give it some data. It&rsquo;s a simple as that.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// Define a Query. We want a string query.</span>
</span><span class='line'><span class="nv">$elasticaQueryString</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">\Elastica\Query\QueryString</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//&#39;And&#39; or &#39;Or&#39; default : &#39;Or&#39;</span>
</span><span class='line'><span class="nv">$elasticaQueryString</span><span class="o">-&gt;</span><span class="na">setDefaultOperator</span><span class="p">(</span><span class="s1">&#39;AND&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$elasticaQueryString</span><span class="o">-&gt;</span><span class="na">setQuery</span><span class="p">(</span><span class="s1">&#39;sesam street&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Create the actual search object with some data.</span>
</span><span class='line'><span class="nv">$elasticaQuery</span>        <span class="o">=</span> <span class="k">new</span> <span class="nx">\Elastica\Query</span><span class="p">();</span>
</span><span class='line'><span class="nv">$elasticaQuery</span><span class="o">-&gt;</span><span class="na">setQuery</span><span class="p">(</span><span class="nv">$elasticaQueryString</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Search on the index.</span>
</span><span class='line'><span class="nv">$elasticaResultSet</span>    <span class="o">=</span> <span class="nv">$elasticaIndex</span><span class="o">-&gt;</span><span class="na">search</span><span class="p">(</span><span class="nv">$elasticaQuery</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I know, at first it seems a bit complicated with the nesting of all the arrays. But it really isn&rsquo;t. The <code>$elasticaQuery</code> contains all the information regarding our query. We will add filter and facets later. Your search can always consist of only one query but as-much-as-you-like filters and facets.</p></p>

<p>If you want a pagination in your application you can use the following commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$elasticaQuery</span><span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>    <span class="c1">// Where to start?</span>
</span><span class='line'><span class="nv">$elasticaQuery</span><span class="o">-&gt;</span><span class="na">setLimit</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>   <span class="c1">// How many?</span>
</span></code></pre></td></tr></table></div></figure>




<h3 id="section-retrieve">Retrieve results</h3>


<p>In the <code>$elasticaResultSet</code> all the resulting documents are stored. You can get them together with some statistics easily.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$elasticaResults</span>  <span class="o">=</span> <span class="nv">$elasticaResultSet</span><span class="o">-&gt;</span><span class="na">getResults</span><span class="p">();</span>
</span><span class='line'><span class="nv">$totalResults</span>         <span class="o">=</span> <span class="nv">$elasticaResultSet</span><span class="o">-&gt;</span><span class="na">getTotalHits</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="nv">$elasticaResults</span> <span class="k">as</span> <span class="nv">$elasticaResult</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$elasticaResult</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<h3 id="section-filter">Add filter</h3>


<p>Adding and nesting filter can get a bit complex but I try to keep it simple. Filters are added to the search query object (<code>$elasticaQuery</code>). Let&rsquo;s assume we already have a query searching for sesam street. We now can define some filters on the resulting data. So if we want to find all muppets that like cookies and are either blue or green, our filters would look something like that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// Filter for being of color blue</span>
</span><span class='line'><span class="nv">$elasticaFilterColorBlue</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">\Elastica\Filter\Term</span><span class="p">();</span>
</span><span class='line'><span class="c1">//search &#39;color&#39; = &#39;blue&#39;</span>
</span><span class='line'><span class="nv">$elasticaFilterColorBlue</span><span class="o">-&gt;</span><span class="na">setTerm</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Filter for being of color green</span>
</span><span class='line'><span class="nv">$elasticaFilterColorGreen</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Elastica\Filter\Term</span><span class="p">();</span>
</span><span class='line'><span class="nv">$elasticaFilterColorGreen</span><span class="o">-&gt;</span><span class="na">setTerm</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!--//</span> <span class="k">Or</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">write</span> <span class="nx">like</span> <span class="nx">that</span> <span class="o">:</span>
</span><span class='line'><span class="nv">$elasticaFilterColorBlue</span><span class="o">-&gt;</span><span class="na">setTerm</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">));</span> <span class="o">--&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Filter for liking cookies</span>
</span><span class='line'><span class="nv">$elasticaFilterLikesCookies</span>   <span class="o">=</span> <span class="k">new</span> <span class="nx">\Elastica\Filter\Term</span><span class="p">();</span>
</span><span class='line'><span class="nv">$elasticaFilterLikesCookies</span><span class="o">-&gt;</span><span class="na">setTerm</span><span class="p">(</span><span class="s1">&#39;likes&#39;</span><span class="p">,</span> <span class="s1">&#39;cookies&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Filter &#39;or&#39; for the color, adding the color filters</span>
</span><span class='line'><span class="nv">$elasticaFilterOr</span>     <span class="o">=</span> <span class="k">new</span> <span class="nx">\Elastica\Filter\BoolOr</span><span class="p">();</span>
</span><span class='line'><span class="nv">$elasticaFilterOr</span><span class="o">-&gt;</span><span class="na">addFilter</span><span class="p">(</span><span class="nv">$elasticaFilterColorBlue</span><span class="p">);</span>
</span><span class='line'><span class="nv">$elasticaFilterOr</span><span class="o">-&gt;</span><span class="na">addFilter</span><span class="p">(</span><span class="nv">$elasticaFilterColorGreen</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Filter &#39;and&#39; for the colors and likes</span>
</span><span class='line'><span class="nv">$elasticaFilterAnd</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">\Elastica\Filter\BoolAnd</span><span class="p">();</span>
</span><span class='line'><span class="nv">$elasticaFilterAnd</span><span class="o">-&gt;</span><span class="na">addFilter</span><span class="p">(</span><span class="nv">$elasticaFilterOr</span><span class="p">);</span>
</span><span class='line'><span class="nv">$elasticaFilterAnd</span><span class="o">-&gt;</span><span class="na">addFilter</span><span class="p">(</span><span class="nv">$elasticaFilterLikesCookies</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Add filter to the search object.</span>
</span><span class='line'><span class="nv">$elasticaQuery</span><span class="o">-&gt;</span><span class="na">setFilter</span><span class="p">(</span><span class="nv">$elasticaFilterAnd</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the filters added, the search is ready to be executed. Probably this would return the cookie monster. But that depends on the data you added to your index, of course.</p>

<h3 id="section-facets">Facets</h3>


<p>A facet returns some information on the data in your database, depending on your search query. So let&rsquo;s say there is a field <code>tag</code> in our documents. In the results of our query we want to know, which tags are used by the results and how many documents have a certain tag. Read more in the <a href="http://www.elasticsearch.org/guide/reference/api/search/facets/">facets API</a>.</p>

<p>Here is a quick example on how to define a facet for your query:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// Define a new facet.</span>
</span><span class='line'><span class="nv">$elasticaFacet</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">\Elastica\Facet\Terms</span><span class="p">(</span><span class="s1">&#39;myFacetName&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$elasticaFacet</span><span class="o">-&gt;</span><span class="na">setField</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$elasticaFacet</span><span class="o">-&gt;</span><span class="na">setSize</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'><span class="nv">$elasticaFacet</span><span class="o">-&gt;</span><span class="na">setOrder</span><span class="p">(</span><span class="s1">&#39;reverse_count&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Add that facet to the search query object.</span>
</span><span class='line'><span class="nv">$elasticaQuery</span><span class="o">-&gt;</span><span class="na">addFacet</span><span class="p">(</span><span class="nv">$elasticaFacet</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will return 10 tags together with a count of the documents in your current filtered search query. Retrieving the facets works similar to the retrieval of the documents.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// Get facets from the result of the search query</span>
</span><span class='line'><span class="nv">$elasticaFacets</span> <span class="o">=</span> <span class="nv">$elasticaResultSet</span><span class="o">-&gt;</span><span class="na">getFacets</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Notice, that myFacetName is the same as above</span>
</span><span class='line'><span class="c1">// when the facet was defined.</span>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="nv">$elasticaFacets</span><span class="p">[</span><span class="s1">&#39;myFacetName&#39;</span><span class="p">][</span><span class="s1">&#39;terms&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$elasticaFacet</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$elasticaFacet</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>A good use case is using the different types in your index as a facet. To get this you&rsquo;ve to define the facet like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$elasticaFacet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Elastica\Facet\Terms</span><span class="p">(</span><span class="s1">&#39;Facettes&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$elasticaFacet</span><span class="o">-&gt;</span><span class="na">setField</span><span class="p">(</span><span class="s1">&#39;_type&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


  
    <footer>
      
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://Elastica.io/getting-started/search-documents.html" data-via="" data-counturl="http://Elastica.io/getting-started/search-documents.html" >Tweet</a>
  
  
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/10/04/release-v1-dot-3-4-dot-0/">Release v1.3.4.0</a>
      </li>
    
      <li class="post">
        <a href="/2014/07/27/release-v1-dot-3-0-dot-0/">Release v1.3.0.0</a>
      </li>
    
      <li class="post">
        <a href="/2014/06/14/release-v1-dot-2-1-dot-0/">Release v1.2.1.0</a>
      </li>
    
      <li class="post">
        <a href="/2014/04/27/release-v1-dot-1-1-dot-1/">Release v1.1.1.1</a>
      </li>
    
      <li class="post">
        <a href="/2014/04/19/release-v1-dot-1-1-dot-0/">Release v1.1.1.0</a>
      </li>
    
  </ul>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/116483615197289019288?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - @ruflin -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
